:root {
  font-family: "Inter", "PingFang SC", "Microsoft YaHei", system-ui, sans-serif;
  --bg: #090b12;
  --bg-accent: #1a1040;
  --text: #eef2ff;
  --muted: #c3cad8;
  --neon: #00e7ff;
  --grad-a: #2a4dff;
  --grad-b: #8b39ff;

  /* Derived global surfaces (subtle contrast baseline) */
  --panel: #171b27;
  --card-bg: #1b2130;
  --input-bg: #1a2030;
  --line: rgba(201, 217, 255, 0.28);
  --soft-line: rgba(201, 217, 255, 0.18);
  --chip-bg: rgba(201, 217, 255, 0.14);
  --chip-text: var(--text);
  --card-tint: rgba(201, 217, 255, 0.06);
  --focus-ring: rgba(201, 217, 255, 0.26);
  --grid-tint: rgba(201, 217, 255, 0.12);
  --status-ok: var(--muted);
  --status-error: #ff7b7b;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  color: var(--text);
  background: radial-gradient(circle at 20% 10%, var(--bg-accent) 0%, var(--bg) 42%);
}
.bg-grid {
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(var(--grid-tint) 1px, transparent 1px),
    linear-gradient(90deg, var(--grid-tint) 1px, transparent 1px);
  background-size: 26px 26px;
  pointer-events: none;
}
.side-rain {
  position: fixed;
  top: 0;
  bottom: 0;
  width: min(11vw, 156px);
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
  mask-image: linear-gradient(to bottom, transparent, black 8%, black 92%, transparent);
}
.side-rain-left { left: 0; }
.side-rain-right { right: 0; }
.rain-col {
  position: absolute;
  top: -130%;
  left: var(--x, 0%);
  width: 14px;
  white-space: pre;
  line-height: 1.05;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  font-size: 11px;
  color: color-mix(in srgb, var(--neon) 72%, transparent 28%);
  text-shadow: 0 0 8px color-mix(in srgb, var(--neon) 45%, transparent 55%);
  opacity: .5;
  will-change: transform;
}

.shell { max-width: 1460px; margin: 0 auto; padding: 16px; position: relative; z-index: 1; }
.panel {
  background: var(--panel);
  border: 0;
  border-radius: 16px;
  backdrop-filter: blur(8px);
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.10);
}
.hero { padding: 18px; margin-bottom: 14px; }
.kicker { color: var(--neon); letter-spacing: .1em; font-size: 12px; }
.muted { color: var(--muted); }
.layout { display: grid; grid-template-columns: minmax(420px, 1fr) minmax(350px, .9fr); gap: 14px; }
.left, .right { padding: 14px; }
.right {
  position: sticky;
  top: 12px;
  height: calc(100vh - 28px);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.section-head { display: flex; justify-content: space-between; gap: 8px; align-items: center; }
.row-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.top-gap { margin-top: 14px; }

.chip {
  border: 0;
  background: color-mix(in srgb, var(--chip-bg) 70%, transparent 30%);
  border-radius: 999px;
  padding: 4px 10px;
  color: var(--chip-text);
  font-size: 12px;
}

.config-grid { display: grid; grid-template-columns: 1fr 220px; gap: 10px; }
label { display: grid; gap: 6px; font-size: 13px; margin-top: 8px; }
input, textarea, button, select {
  background: var(--input-bg);
  border: 0;
  color: var(--text);
  border-radius: 10px;
  padding: 10px;
  font-size: 14px;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  box-shadow: 0 0 0 1.5px var(--line) inset;
}
input[type='checkbox'] { accent-color: var(--neon); }
button {
  cursor: pointer;
  border: 0;
  background:
    linear-gradient(180deg, color-mix(in srgb, #fff 12%, transparent 88%) 0%, transparent 34%),
    linear-gradient(105deg, var(--grad-a), var(--grad-b));
  box-shadow:
    0 6px 14px color-mix(in srgb, var(--grad-b) 32%, transparent 68%),
    0 0 0 1px color-mix(in srgb, var(--grad-a) 28%, transparent 72%) inset;
  font-weight: 600;
  transition: transform .16s ease, filter .2s ease;
}
button:hover { filter: saturate(1.08) brightness(1.04); }
button:active { transform: translateY(1px) scale(.995); }
button.ghost {
  background: color-mix(in srgb, var(--chip-bg) 78%, transparent 22%);
  border: 0;
}

.axis-container { display: grid; gap: 10px; margin-top: 8px; }
.axis-group {
  border: 0;
  border-radius: 10px;
  padding: 10px;
  background: color-mix(in srgb, var(--card-bg) 84%, transparent 16%);
}
.axis-group + .axis-group { margin-top: 6px; }
.axis-group.active-axis { box-shadow: none; }
.axis-head { display: flex; justify-content: space-between; align-items: center; }
.axis-desc { margin: 8px 0 2px; color: var(--muted); font-size: 13px; line-height: 1.5; }
.options { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 6px; margin-top: 8px; }
.option-item {
  display: grid;
  gap: 4px;
  border: 0;
  border-radius: 8px;
  padding: 8px;
  font-size: 13px;
  background: color-mix(in srgb, var(--input-bg) 78%, transparent 22%);
}
.option-item:hover { background: color-mix(in srgb, var(--input-bg) 64%, var(--chip-bg) 36%); }
.option-desc { color: var(--muted); font-size: 12px; }

.prompt-guide {
  margin-top: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--input-bg) 82%, transparent 18%);
}
.prompt-guide summary {
  cursor: pointer;
  font-weight: 600;
  color: var(--text);
}
.prompt-guide ul {
  margin: 10px 0 0;
  padding-left: 18px;
  display: grid;
  gap: 6px;
}
.prompt-guide li { color: var(--muted); line-height: 1.5; }

.actions { display: flex; gap: 8px; margin-top: 10px; }

.result-panel { margin-top: 14px; padding-top: 8px; }
.result-wrap,
.thinking-panel {
  margin-top: 6px;
  border-radius: 10px;
  background: color-mix(in srgb, var(--input-bg) 70%, transparent 30%);
  padding: 6px 8px;
}
.result-wrap summary,
.thinking-panel summary {
  cursor: pointer;
  color: var(--text);
  font-weight: 600;
}
.result { margin-top: 6px; }
.result-title {
  margin: 10px 0 4px;
  font-size: 15px;
  line-height: 1.35;
  color: var(--text);
}
.result-line {
  line-height: 1.55;
  color: var(--muted);
  white-space: pre-wrap;
  font-size: 13px;
}
.result-bullet { padding-left: 8px; }
.result-blank { height: 5px; }

.trace-log {
  display: grid;
  gap: 3px;
  margin-top: 4px;
}
.trace-item {
  display: grid;
  grid-template-columns: 52px 1fr;
  gap: 6px;
  align-items: start;
  color: var(--muted);
}
.trace-time {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  color: color-mix(in srgb, var(--neon) 55%, var(--text) 45%);
  font-size: 11px;
}
.trace-text { line-height: 1.3; font-size: 12px; }
.trace-meta {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px dashed color-mix(in srgb, var(--line) 60%, transparent 40%);
  color: var(--muted);
  display: grid;
  gap: 2px;
  font-size: 12px;
}

.selected-explain {
  border: 0;
  border-radius: 10px;
  background: transparent;
  padding: 2px;
  overflow: auto;
}
.selected-explain-live {
  flex: 1 1 auto;
  min-height: 220px;
}
.selected-explain-static {
  flex: 0 0 auto;
  min-height: 160px;
  max-height: 32vh;
}
.explain-card {
  border: 0;
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 8px;
  background: color-mix(in srgb, var(--card-bg) 82%, transparent 18%);
}
.explain-card h4 { margin: 0 0 6px; color: var(--text); display: flex; justify-content: space-between; align-items: center; gap: 8px; }
.explain-card p { margin: 0; color: var(--muted); line-height: 1.6; font-size: 13px; white-space: pre-wrap; }
.pin-btn {
  background: color-mix(in srgb, var(--chip-bg) 78%, transparent 22%);
  border: 0;
  color: var(--chip-text);
  border-radius: 6px;
  padding: 2px 8px;
  font-size: 12px;
}
.mobile-toggle { display: none; }
.theme-picker { min-width: 170px; }

@media (max-width: 1100px) {
  .side-rain { display: none; }
  .layout { grid-template-columns: 1fr; }
  .right {
    position: fixed;
    left: 8px;
    right: 8px;
    bottom: 8px;
    top: auto;
    height: 58vh;
    z-index: 20;
    transform: translateY(calc(100% - 52px));
    transition: transform .25s ease;
  }
  .right.open { transform: translateY(0); }
  .mobile-toggle {
    display: block;
    position: fixed;
    right: 12px;
    bottom: 12px;
    z-index: 30;
    min-height: 44px;
    padding: 10px 14px;
    border-radius: 12px;
  }
  .selected-explain-live { min-height: 20vh; }
  .selected-explain-static { min-height: 14vh; max-height: 22vh; }
}

/* Theme packs (hue-matched, softer contrast) */
body.theme-green {
  --neon:#5bdc98; --bg-accent:#12271f; --grad-a:#24b36a; --grad-b:#59d6c9;
  --panel:#172921; --card-bg:#1d3329; --input-bg:#1a2f25;
  --text:#eaf7f0; --muted:#bbd5c7;
  --line:rgba(134, 209, 172, 0.20); --soft-line:rgba(134, 209, 172, 0.12);
  --chip-bg:rgba(134, 209, 172, 0.16); --card-tint:rgba(134, 209, 172, 0.10); --grid-tint:rgba(134, 209, 172, 0.10);
}
body.theme-yellow {
  --neon:#e7c85d; --bg-accent:#2a240f; --grad-a:#a6c32a; --grad-b:#ffd86f;
  --panel:#2c2512; --card-bg:#362e18; --input-bg:#322a16;
  --text:#faf5e6; --muted:#d8cda9;
  --line:rgba(220, 191, 105, 0.20); --soft-line:rgba(220, 191, 105, 0.12);
  --chip-bg:rgba(220, 191, 105, 0.16); --card-tint:rgba(220, 191, 105, 0.10); --grid-tint:rgba(220, 191, 105, 0.10);
}
body.theme-pink {
  --neon:#da75bf; --bg-accent:#281824; --grad-a:#8f63e8; --grad-b:#ff8fcf;
  --panel:#2c1c28; --card-bg:#372431; --input-bg:#32212d;
  --text:#f8eef5; --muted:#d7bfd0;
  --line:rgba(217, 142, 194, 0.20); --soft-line:rgba(217, 142, 194, 0.12);
  --chip-bg:rgba(217, 142, 194, 0.16); --card-tint:rgba(217, 142, 194, 0.10); --grid-tint:rgba(217, 142, 194, 0.10);
}
body.theme-red {
  --neon:#de7a7a; --bg-accent:#2a1719; --grad-a:#d94d63; --grad-b:#ff9b63;
  --panel:#2d1a1c; --card-bg:#382325; --input-bg:#332022;
  --text:#f9eded; --muted:#d8c0c0;
  --line:rgba(221, 144, 144, 0.20); --soft-line:rgba(221, 144, 144, 0.12);
  --chip-bg:rgba(221, 144, 144, 0.16); --card-tint:rgba(221, 144, 144, 0.10); --grid-tint:rgba(221, 144, 144, 0.10);
}
body.theme-purple {
  --neon:#a78adf; --bg-accent:#1f1b31; --grad-a:#5c7cff; --grad-b:#cc8dff;
  --panel:#25203a; --card-bg:#302949; --input-bg:#2b2542;
  --text:#f2eff9; --muted:#cbbfdf;
  --line:rgba(174, 151, 221, 0.20); --soft-line:rgba(174, 151, 221, 0.12);
  --chip-bg:rgba(174, 151, 221, 0.16); --card-tint:rgba(174, 151, 221, 0.10); --grid-tint:rgba(174, 151, 221, 0.10);
}
body.theme-orange {
  --neon:#e49a62; --bg-accent:#2a1a12; --grad-a:#ff6f4d; --grad-b:#ffc45e;
  --panel:#2d1d14; --card-bg:#38251a; --input-bg:#332217;
  --text:#f9f0e9; --muted:#d9c4b4;
  --line:rgba(225, 163, 112, 0.20); --soft-line:rgba(225, 163, 112, 0.12);
  --chip-bg:rgba(225, 163, 112, 0.16); --card-tint:rgba(225, 163, 112, 0.10); --grid-tint:rgba(225, 163, 112, 0.10);
}

@media (max-width: 720px) {
  .shell { padding: 10px; }
  .hero, .left, .right { padding: 12px; }
  .section-head h2 { font-size: 22px; }
  .config-grid { grid-template-columns: 1fr; }
  .options { grid-template-columns: 1fr; }
  .option-item { padding: 12px; min-height: 52px; }
  input[type='checkbox'] { transform: scale(1.15); }
  .actions { flex-direction: column; }
  .actions button { width: 100%; min-height: 44px; }
}
